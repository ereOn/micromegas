
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Unified observability platform with high-performance telemetry collection and analytics">
      
      
      
        <link rel="canonical" href="https://micromegas.dev/query-guide/functions-reference/">
      
      
        <link rel="prev" href="../schema-reference/">
      
      
        <link rel="next" href="../query-patterns/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Functions Reference - Micromegas Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#functions-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Micromegas Documentation" class="md-header__button md-logo" aria-label="Micromegas Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Micromegas Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Functions Reference
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/madesroches/micromegas" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    madesroches/micromegas
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/" class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Query Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../admin/functions-reference/" class="md-tabs__link">
          
  
  
  Administration

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../unreal/" class="md-tabs__link">
          
  
  
  Unreal Engine

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../cost-effectiveness/" class="md-tabs__link">
          
  
  
  Cost Effectiveness

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contributing/" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Micromegas Documentation" class="md-nav__button md-logo" aria-label="Micromegas Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Micromegas Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/madesroches/micromegas" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    madesroches/micromegas
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Query Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Query Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../python-api-advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Python API Advanced
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../schema-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema Reference
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Functions Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Functions Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#micromegas-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Micromegas Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Micromegas Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Table Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Table Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view_instanceview_name-identifier" class="md-nav__link">
    <span class="md-ellipsis">
      view_instance(view_name, identifier)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list_partitions" class="md-nav__link">
    <span class="md-ellipsis">
      list_partitions() ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retire_partitionsview_set_name-view_instance_id-begin_insert_time-end_insert_time" class="md-nav__link">
    <span class="md-ellipsis">
      retire_partitions(view_set_name, view_instance_id, begin_insert_time, end_insert_time) ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#materialize_partitionsview_name-begin_insert_time-end_insert_time-partition_delta_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      materialize_partitions(view_name, begin_insert_time, end_insert_time, partition_delta_seconds) ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list_view_sets" class="md-nav__link">
    <span class="md-ellipsis">
      list_view_sets() ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retire_partition_by_filefile_path" class="md-nav__link">
    <span class="md-ellipsis">
      retire_partition_by_file(file_path) ðŸ”§
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scalar-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Scalar Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scalar Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jsonjsonb-functions" class="md-nav__link">
    <span class="md-ellipsis">
      JSON/JSONB Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON/JSONB Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jsonb_parsejson_string" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_parse(json_string)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_getjsonb-key" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_get(jsonb, key)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_format_jsonjsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_format_json(jsonb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_as_stringjsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_as_string(jsonb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_as_f64jsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_as_f64(jsonb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_as_i64jsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_as_i64(jsonb)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-access-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Data Access Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Access Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_payloadprocess_id-stream_id-block_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_payload(process_id, stream_id, block_id)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Property Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Property Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#property_getproperties-key" class="md-nav__link">
    <span class="md-ellipsis">
      property_get(properties, key)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_lengthproperties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_length(properties)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_to_dictproperties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_to_dict(properties)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_to_jsonbproperties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_to_jsonb(properties)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_to_arraydict_properties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_to_array(dict_properties)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#histogram-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Histogram Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Histogram Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make_histogramstart-end-bins-values" class="md-nav__link">
    <span class="md-ellipsis">
      make_histogram(start, end, bins, values)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sum_histogramshistogram_column" class="md-nav__link">
    <span class="md-ellipsis">
      sum_histograms(histogram_column)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quantile_from_histogramhistogram-quantile" class="md-nav__link">
    <span class="md-ellipsis">
      quantile_from_histogram(histogram, quantile)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variance_from_histogramhistogram" class="md-nav__link">
    <span class="md-ellipsis">
      variance_from_histogram(histogram)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count_from_histogramhistogram" class="md-nav__link">
    <span class="md-ellipsis">
      count_from_histogram(histogram)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sum_from_histogramhistogram" class="md-nav__link">
    <span class="md-ellipsis">
      sum_from_histogram(histogram)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-sql-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Standard SQL Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-query-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Query Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Query Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#histogram-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Histogram Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-extraction-and-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Property Extraction and Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-performance-jsonb-property-access" class="md-nav__link">
    <span class="md-ellipsis">
      High-Performance JSONB Property Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-data-processing" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Data Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-based-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      Time-based Aggregation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-trace-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Trace Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datafusion-reference" class="md-nav__link">
    <span class="md-ellipsis">
      DataFusion Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../query-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Patterns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../async-performance-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Async Performance Analysis
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced-features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Administration
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Administration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/functions-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Unreal Engine
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Unreal Engine
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../unreal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../unreal/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../unreal/instrumentation-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Instrumentation API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../unreal/examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cost Effectiveness
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Cost Effectiveness
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-effectiveness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-comparisons/cost-modeling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cost Modeling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-comparisons/datadog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vs. Datadog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-comparisons/dynatrace/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vs. Dynatrace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-comparisons/elastic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vs. Elastic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-comparisons/grafana/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vs. Grafana Cloud
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-comparisons/newrelic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vs. New Relic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cost-comparisons/splunk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vs. Splunk
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#micromegas-extensions" class="md-nav__link">
    <span class="md-ellipsis">
      Micromegas Extensions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Micromegas Extensions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#table-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Table Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Table Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#view_instanceview_name-identifier" class="md-nav__link">
    <span class="md-ellipsis">
      view_instance(view_name, identifier)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list_partitions" class="md-nav__link">
    <span class="md-ellipsis">
      list_partitions() ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retire_partitionsview_set_name-view_instance_id-begin_insert_time-end_insert_time" class="md-nav__link">
    <span class="md-ellipsis">
      retire_partitions(view_set_name, view_instance_id, begin_insert_time, end_insert_time) ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#materialize_partitionsview_name-begin_insert_time-end_insert_time-partition_delta_seconds" class="md-nav__link">
    <span class="md-ellipsis">
      materialize_partitions(view_name, begin_insert_time, end_insert_time, partition_delta_seconds) ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#list_view_sets" class="md-nav__link">
    <span class="md-ellipsis">
      list_view_sets() ðŸ”§
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retire_partition_by_filefile_path" class="md-nav__link">
    <span class="md-ellipsis">
      retire_partition_by_file(file_path) ðŸ”§
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scalar-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Scalar Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scalar Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jsonjsonb-functions" class="md-nav__link">
    <span class="md-ellipsis">
      JSON/JSONB Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JSON/JSONB Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jsonb_parsejson_string" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_parse(json_string)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_getjsonb-key" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_get(jsonb, key)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_format_jsonjsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_format_json(jsonb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_as_stringjsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_as_string(jsonb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_as_f64jsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_as_f64(jsonb)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jsonb_as_i64jsonb" class="md-nav__link">
    <span class="md-ellipsis">
      jsonb_as_i64(jsonb)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-access-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Data Access Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Access Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get_payloadprocess_id-stream_id-block_id" class="md-nav__link">
    <span class="md-ellipsis">
      get_payload(process_id, stream_id, block_id)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Property Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Property Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#property_getproperties-key" class="md-nav__link">
    <span class="md-ellipsis">
      property_get(properties, key)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_lengthproperties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_length(properties)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_to_dictproperties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_to_dict(properties)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_to_jsonbproperties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_to_jsonb(properties)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties_to_arraydict_properties" class="md-nav__link">
    <span class="md-ellipsis">
      properties_to_array(dict_properties)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#histogram-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Histogram Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Histogram Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#make_histogramstart-end-bins-values" class="md-nav__link">
    <span class="md-ellipsis">
      make_histogram(start, end, bins, values)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sum_histogramshistogram_column" class="md-nav__link">
    <span class="md-ellipsis">
      sum_histograms(histogram_column)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#quantile_from_histogramhistogram-quantile" class="md-nav__link">
    <span class="md-ellipsis">
      quantile_from_histogram(histogram, quantile)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variance_from_histogramhistogram" class="md-nav__link">
    <span class="md-ellipsis">
      variance_from_histogram(histogram)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count_from_histogramhistogram" class="md-nav__link">
    <span class="md-ellipsis">
      count_from_histogram(histogram)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sum_from_histogramhistogram" class="md-nav__link">
    <span class="md-ellipsis">
      sum_from_histogram(histogram)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#standard-sql-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Standard SQL Functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-query-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Query Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Query Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#histogram-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Histogram Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property-extraction-and-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Property Extraction and Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#high-performance-jsonb-property-access" class="md-nav__link">
    <span class="md-ellipsis">
      High-Performance JSONB Property Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-data-processing" class="md-nav__link">
    <span class="md-ellipsis">
      JSON Data Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-based-aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      Time-based Aggregation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-trace-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Trace Analysis
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datafusion-reference" class="md-nav__link">
    <span class="md-ellipsis">
      DataFusion Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="functions-reference">Functions Reference<a class="headerlink" href="#functions-reference" title="Permanent link">&para;</a></h1>
<p>This page provides a complete reference to all SQL functions available in Micromegas queries, including both standard DataFusion functions and Micromegas-specific extensions.</p>
<h2 id="micromegas-extensions">Micromegas Extensions<a class="headerlink" href="#micromegas-extensions" title="Permanent link">&para;</a></h2>
<h3 id="table-functions">Table Functions<a class="headerlink" href="#table-functions" title="Permanent link">&para;</a></h3>
<p>Table functions return tables that can be used in FROM clauses.</p>
<h4 id="view_instanceview_name-identifier"><code>view_instance(view_name, identifier)</code><a class="headerlink" href="#view_instanceview_name-identifier" title="Permanent link">&para;</a></h4>
<p>Creates a process or stream-scoped view instance for better performance.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">view_instance</span><span class="p">(</span><span class="n">view_name</span><span class="p">,</span><span class="w"> </span><span class="n">identifier</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>view_name</code> (<code>Utf8</code>): Name of the view ('log_entries', 'measures', 'thread_spans', 'async_events')</p>
</li>
<li>
<p><code>identifier</code> (<code>Utf8</code>): Process ID (for most views) or Stream ID (for thread_spans)</p>
</li>
</ul>
<p><strong>Returns:</strong> Schema depends on the view type (see <a href="../schema-reference/">Schema Reference</a>)</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">-- Get logs for a specific process</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">time</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">view_instance</span><span class="p">(</span><span class="s1">&#39;log_entries&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;my_process_123&#39;</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1">-- Get spans for a specific stream</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">view_instance</span><span class="p">(</span><span class="s1">&#39;thread_spans&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;stream_456&#39;</span><span class="p">)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span><span class="w">  </span><span class="c1">-- &gt; 1ms</span>
</span></code></pre></div></p>
<h4 id="list_partitions"><code>list_partitions()</code> ðŸ”§<a class="headerlink" href="#list_partitions" title="Permanent link">&para;</a></h4>
<p><strong>Administrative Function</strong> - Lists available data partitions in the lakehouse.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">list_partitions</span><span class="p">()</span>
</span></code></pre></div></p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>view_set_name</td>
<td>Utf8</td>
<td>Name of the view set</td>
</tr>
<tr>
<td>view_instance_id</td>
<td>Utf8</td>
<td>Instance identifier</td>
</tr>
<tr>
<td>begin_insert_time</td>
<td>Timestamp(Nanosecond)</td>
<td>Partition start time</td>
</tr>
<tr>
<td>end_insert_time</td>
<td>Timestamp(Nanosecond)</td>
<td>Partition end time</td>
</tr>
<tr>
<td>min_event_time</td>
<td>Timestamp(Nanosecond)</td>
<td>Earliest event time</td>
</tr>
<tr>
<td>max_event_time</td>
<td>Timestamp(Nanosecond)</td>
<td>Latest event time</td>
</tr>
<tr>
<td>updated</td>
<td>Timestamp(Nanosecond)</td>
<td>Last update time</td>
</tr>
<tr>
<td>file_path</td>
<td>Utf8</td>
<td>Partition file path</td>
</tr>
<tr>
<td>file_size</td>
<td>Int64</td>
<td>File size in bytes</td>
</tr>
<tr>
<td>file_schema_hash</td>
<td>Binary</td>
<td>Hash of the file schema</td>
</tr>
<tr>
<td>source_data_hash</td>
<td>Binary</td>
<td>Hash of the source data</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1">-- View partition information</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">view_set_name</span><span class="p">,</span><span class="w"> </span><span class="n">view_instance_id</span><span class="p">,</span><span class="w"> </span><span class="n">file_size</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">list_partitions</span><span class="p">()</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong>â„¹ï¸ Administrative Use:</strong> This function provides system-level partition metadata primarily useful for administrators monitoring lakehouse storage and partition management. Regular users querying data typically don't need this information.</p>
<h4 id="retire_partitionsview_set_name-view_instance_id-begin_insert_time-end_insert_time"><code>retire_partitions(view_set_name, view_instance_id, begin_insert_time, end_insert_time)</code> ðŸ”§<a class="headerlink" href="#retire_partitionsview_set_name-view_instance_id-begin_insert_time-end_insert_time" title="Permanent link">&para;</a></h4>
<p><strong>Administrative Function</strong> - Retires (removes) data partitions from the lakehouse for a specified time range. Returns a log stream of the operation.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">retire_partitions</span><span class="p">(</span><span class="n">view_set_name</span><span class="p">,</span><span class="w"> </span><span class="n">view_instance_id</span><span class="p">,</span><span class="w"> </span><span class="n">begin_insert_time</span><span class="p">,</span><span class="w"> </span><span class="n">end_insert_time</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>view_set_name</code> (<code>Utf8</code>): Name of the view set</p>
</li>
<li>
<p><code>view_instance_id</code> (<code>Utf8</code>): Instance identifier</p>
</li>
<li>
<p><code>begin_insert_time</code> (<code>Timestamp(Nanosecond)</code>): Start time for partition retirement</p>
</li>
<li>
<p><code>end_insert_time</code> (<code>Timestamp(Nanosecond)</code>): End time for partition retirement</p>
</li>
</ul>
<p><strong>Returns:</strong> Log stream table with operation progress and messages</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">-- Retire old partitions for a specific view</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">retire_partitions</span><span class="p">(</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="s1">&#39;log_entries&#39;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="s1">&#39;global&#39;</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;30 days&#39;</span><span class="p">,</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;7 days&#39;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="p">);</span>
</span></code></pre></div></p>
<p><strong>âš ï¸ DESTRUCTIVE OPERATION:</strong> This function permanently removes data partitions from the lakehouse, making the contained data inaccessible. Use only for data retention management and with extreme caution in production environments. Ensure proper backups exist before retiring partitions.</p>
<h4 id="materialize_partitionsview_name-begin_insert_time-end_insert_time-partition_delta_seconds"><code>materialize_partitions(view_name, begin_insert_time, end_insert_time, partition_delta_seconds)</code> ðŸ”§<a class="headerlink" href="#materialize_partitionsview_name-begin_insert_time-end_insert_time-partition_delta_seconds" title="Permanent link">&para;</a></h4>
<p><strong>Administrative Function</strong> - Materializes data partitions for a view over a specified time range. Returns a log stream of the operation.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">materialize_partitions</span><span class="p">(</span><span class="n">view_name</span><span class="p">,</span><span class="w"> </span><span class="n">begin_insert_time</span><span class="p">,</span><span class="w"> </span><span class="n">end_insert_time</span><span class="p">,</span><span class="w"> </span><span class="n">partition_delta_seconds</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>view_name</code> (<code>Utf8</code>): Name of the view to materialize</p>
</li>
<li>
<p><code>begin_insert_time</code> (<code>Timestamp(Nanosecond)</code>): Start time for materialization</p>
</li>
<li>
<p><code>end_insert_time</code> (<code>Timestamp(Nanosecond)</code>): End time for materialization</p>
</li>
<li>
<p><code>partition_delta_seconds</code> (<code>Int64</code>): Partition time delta in seconds</p>
</li>
</ul>
<p><strong>Returns:</strong> Log stream table with operation progress and messages</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1">-- Materialize partitions for CPU usage view</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">materialize_partitions</span><span class="p">(</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="s1">&#39;cpu_usage_per_process_per_minute&#39;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="n">NOW</span><span class="p">(),</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="mi">3600</span><span class="w">  </span><span class="c1">-- 1 hour partitions</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="p">);</span>
</span></code></pre></div></p>
<p><strong>âš ï¸ Administrative Use Only:</strong> This function is intended for system administrators and data engineers managing the lakehouse infrastructure. Regular users querying data should not need to call this function. It triggers background processing to create materialized partitions and can impact system performance.</p>
<h4 id="list_view_sets"><code>list_view_sets()</code> ðŸ”§<a class="headerlink" href="#list_view_sets" title="Permanent link">&para;</a></h4>
<p><strong>Administrative Function</strong> - Lists all available view sets with their current schema information. Useful for schema discovery and management.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">list_view_sets</span><span class="p">()</span>
</span></code></pre></div></p>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>view_set_name</td>
<td>Utf8</td>
<td>Name of the view set (e.g., 'log_entries', 'measures')</td>
</tr>
<tr>
<td>current_schema_hash</td>
<td>Binary</td>
<td>Current schema version identifier</td>
</tr>
<tr>
<td>schema</td>
<td>Utf8</td>
<td>Full schema as formatted string</td>
</tr>
<tr>
<td>has_view_maker</td>
<td>Boolean</td>
<td>Whether view set supports process-specific instances</td>
</tr>
<tr>
<td>global_instance_available</td>
<td>Boolean</td>
<td>Whether a global instance exists</td>
</tr>
</tbody>
</table>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1">-- View all available view sets and their schemas</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">view_set_name</span><span class="p">,</span><span class="w"> </span><span class="n">current_schema_hash</span><span class="p">,</span><span class="w"> </span><span class="n">has_view_maker</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">list_view_sets</span><span class="p">()</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">view_set_name</span><span class="p">;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="c1">-- Check schema for specific view set</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">schema</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">list_view_sets</span><span class="p">()</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">view_set_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;log_entries&#39;</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong>â„¹ï¸ Administrative Use:</strong> This function provides schema discovery for administrators managing view compatibility and schema evolution. It shows the current schema versions and capabilities of each view set in the lakehouse.</p>
<h4 id="retire_partition_by_filefile_path"><code>retire_partition_by_file(file_path)</code> ðŸ”§<a class="headerlink" href="#retire_partition_by_filefile_path" title="Permanent link">&para;</a></h4>
<p><strong>Administrative Function</strong> - Retires a single partition by its exact file path. Provides targeted partition removal for schema evolution and maintenance.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">retire_partition_by_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">result</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>file_path</code> (<code>Utf8</code>): Exact file path of the partition to retire</li>
</ul>
<p><strong>Returns:</strong> <code>Utf8</code> - Result message indicating success or failure</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1">-- Retire a specific partition</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">retire_partition_by_file</span><span class="p">(</span><span class="s1">&#39;/lakehouse/log_entries/process-123/2024/01/01/partition.parquet&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">result</span><span class="p">;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1">-- Retire multiple partitions (use with list_partitions())</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">retire_partition_by_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">result</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="k">FROM</span><span class="w"> </span><span class="n">list_partitions</span><span class="p">()</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">view_set_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;log_entries&#39;</span><span class="w"> </span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">file_schema_hash</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">&#39;[4]&#39;</span><span class="w">  </span><span class="c1">-- Retire old schema versions</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong>âš ï¸ DESTRUCTIVE OPERATION:</strong> This function permanently removes a single data partition from the lakehouse, making the contained data inaccessible. Unlike <code>retire_partitions()</code> which operates on time ranges, this function targets exact file paths for precise partition management. Ensure proper backups exist before retiring partitions.</p>
<p><strong>âœ… Safety Note:</strong> This function only affects the specified partition file. It cannot accidentally retire other partitions, making it safer than time-range-based retirement for schema evolution tasks.</p>
<h3 id="scalar-functions">Scalar Functions<a class="headerlink" href="#scalar-functions" title="Permanent link">&para;</a></h3>
<h4 id="jsonjsonb-functions">JSON/JSONB Functions<a class="headerlink" href="#jsonjsonb-functions" title="Permanent link">&para;</a></h4>
<p>Micromegas provides functions for working with JSON data stored in binary JSONB format for efficient storage and querying.</p>
<h5 id="jsonb_parsejson_string"><code>jsonb_parse(json_string)</code><a class="headerlink" href="#jsonb_parsejson_string" title="Permanent link">&para;</a></h5>
<p>Parses a JSON string into binary JSONB format.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>json_string</code> (<code>Utf8</code>): JSON string to parse</li>
</ul>
<p><strong>Returns:</strong> <code>Binary</code> - Parsed JSONB data</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">-- Parse JSON string into JSONB</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_parse</span><span class="p">(</span><span class="s1">&#39;{&quot;name&quot;: &quot;web_server&quot;, &quot;port&quot;: 8080}&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">parsed_json</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">processes</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="jsonb_getjsonb-key"><code>jsonb_get(jsonb, key)</code><a class="headerlink" href="#jsonb_getjsonb-key" title="Permanent link">&para;</a></h5>
<p>Extracts a value from a JSONB object by key name.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>jsonb</code> (<code>Binary</code>): JSONB object</p>
</li>
<li>
<p><code>key</code> (<code>Utf8</code>): Key name to extract</p>
</li>
</ul>
<p><strong>Returns:</strong> <code>Binary</code> - JSONB value or NULL if key not found</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">-- Extract name field from JSON data</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="s1">&#39;{&quot;name&quot;: &quot;web_server&quot;, &quot;port&quot;: 8080}&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">name_value</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">processes</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="jsonb_format_jsonjsonb"><code>jsonb_format_json(jsonb)</code><a class="headerlink" href="#jsonb_format_jsonjsonb" title="Permanent link">&para;</a></h5>
<p>Converts a JSONB value back to a human-readable JSON string.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">jsonb_format_json</span><span class="p">(</span><span class="n">jsonb</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>jsonb</code> (Multiple formats supported): JSONB value in any of these formats:</p>
</li>
<li>
<p><code>Dictionary&lt;Int32, Binary&gt;</code> - <strong>Dictionary-encoded JSONB (default)</strong></p>
</li>
<li><code>Binary</code> - Non-dictionary JSONB</li>
</ul>
<p><strong>Returns:</strong> <code>Utf8</code> - JSON string representation</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">-- Format JSONB back to JSON string</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_format_json</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="s1">&#39;{&quot;name&quot;: &quot;web_server&quot;}&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">json_string</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">processes</span><span class="p">;</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="c1">-- Works directly with dictionary-encoded properties</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_format_json</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">json_props</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span><span class="p">;</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="c1">-- Format property values as JSON</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_format_json</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">json_string</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="k">FROM</span><span class="w"> </span><span class="n">processes</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="jsonb_as_stringjsonb"><code>jsonb_as_string(jsonb)</code><a class="headerlink" href="#jsonb_as_stringjsonb" title="Permanent link">&para;</a></h5>
<p>Casts a JSONB value to a string.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">jsonb_as_string</span><span class="p">(</span><span class="n">jsonb</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>jsonb</code> (<code>Binary</code>): JSONB value to convert</li>
</ul>
<p><strong>Returns:</strong> <code>Utf8</code> - String value or NULL if not a string</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1">-- Extract string value from JSONB</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_as_string</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="s1">&#39;{&quot;service&quot;: &quot;web_server&quot;}&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">service_name</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">processes</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="jsonb_as_f64jsonb"><code>jsonb_as_f64(jsonb)</code><a class="headerlink" href="#jsonb_as_f64jsonb" title="Permanent link">&para;</a></h5>
<p>Casts a JSONB value to a 64-bit float.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">jsonb_as_f64</span><span class="p">(</span><span class="n">jsonb</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>jsonb</code> (<code>Binary</code>): JSONB value to convert</li>
</ul>
<p><strong>Returns:</strong> <code>Float64</code> - Numeric value or NULL if not a number</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">-- Extract numeric value from JSONB</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_as_f64</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="s1">&#39;{&quot;cpu_usage&quot;: 75.5}&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;cpu_usage&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cpu_usage</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">processes</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="jsonb_as_i64jsonb"><code>jsonb_as_i64(jsonb)</code><a class="headerlink" href="#jsonb_as_i64jsonb" title="Permanent link">&para;</a></h5>
<p>Casts a JSONB value to a 64-bit integer.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">jsonb_as_i64</span><span class="p">(</span><span class="n">jsonb</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>jsonb</code> (<code>Binary</code>): JSONB value to convert</li>
</ul>
<p><strong>Returns:</strong> <code>Int64</code> - Integer value or NULL if not an integer</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">-- Extract integer value from JSONB</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_as_i64</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="s1">&#39;{&quot;port&quot;: 8080}&#39;</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;port&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">port_number</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">processes</span><span class="p">;</span>
</span></code></pre></div></p>
<h4 id="data-access-functions">Data Access Functions<a class="headerlink" href="#data-access-functions" title="Permanent link">&para;</a></h4>
<h5 id="get_payloadprocess_id-stream_id-block_id"><code>get_payload(process_id, stream_id, block_id)</code><a class="headerlink" href="#get_payloadprocess_id-stream_id-block_id" title="Permanent link">&para;</a></h5>
<p>Retrieves the raw binary payload of a telemetry block from data lake storage.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">get_payload</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span><span class="w"> </span><span class="n">stream_id</span><span class="p">,</span><span class="w"> </span><span class="n">block_id</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>process_id</code> (<code>Utf8</code>): Process identifier</p>
</li>
<li>
<p><code>stream_id</code> (<code>Utf8</code>): Stream identifier</p>
</li>
<li>
<p><code>block_id</code> (<code>Utf8</code>): Block identifier</p>
</li>
</ul>
<p><strong>Returns:</strong> <code>Binary</code> - Raw block payload data</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1">-- Get raw payload data for specific blocks</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">process_id</span><span class="p">,</span><span class="w"> </span><span class="n">stream_id</span><span class="p">,</span><span class="w"> </span><span class="n">block_id</span><span class="p">,</span><span class="w"> </span><span class="n">get_payload</span><span class="p">(</span><span class="n">process_id</span><span class="p">,</span><span class="w"> </span><span class="n">stream_id</span><span class="p">,</span><span class="w"> </span><span class="n">block_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">payload</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">blocks</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">insert_time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 hour&#39;</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong>Note:</strong> This is an async function that fetches data from object storage. Use sparingly in queries as it can impact performance.</p>
<h4 id="property-functions">Property Functions<a class="headerlink" href="#property-functions" title="Permanent link">&para;</a></h4>
<p>Micromegas provides specialized functions for working with property data, including efficient dictionary encoding for memory optimization.</p>
<h5 id="property_getproperties-key"><code>property_get(properties, key)</code><a class="headerlink" href="#property_getproperties-key" title="Permanent link">&para;</a></h5>
<p>Extracts a value from a properties map with automatic format detection and optimized performance for JSONB data.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">property_get</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span><span class="w"> </span><span class="k">key</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>properties</code> (Multiple formats supported): Properties data in any of these formats:</p>
<ul>
<li><code>Dictionary&lt;Int32, Binary&gt;</code> - <strong>JSONB format (default, optimized)</strong></li>
<li><code>List&lt;Struct&lt;key, value&gt;&gt;</code> - Legacy format (automatic conversion)</li>
<li><code>Dictionary&lt;Int32, List&lt;Struct&gt;&gt;</code> - Dictionary-encoded legacy</li>
<li><code>Binary</code> - Non-dictionary JSONB</li>
</ul>
</li>
<li>
<p><code>key</code> (<code>Utf8</code>): Property key to extract</p>
</li>
</ul>
<p><strong>Returns:</strong> <code>Dictionary&lt;Int32, Utf8&gt;</code> - Property value or NULL if not found</p>
<p><strong>Performance:</strong> Optimized for the new JSONB format. Legacy formats are automatically converted for backward compatibility.</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1">-- Get thread name from process properties (works with all formats)</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">time</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">process_properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;thread-name&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">thread</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">process_properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;thread-name&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="c1">-- Filter by custom property</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">time</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">value</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;source&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;system_monitor&#39;</span><span class="p">;</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="c1">-- Direct JSONB property access (post-migration default)</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">time</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">service</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;env&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="properties_lengthproperties"><code>properties_length(properties)</code><a class="headerlink" href="#properties_lengthproperties" title="Permanent link">&para;</a></h5>
<p>Returns the number of properties in a properties map with support for multiple storage formats.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">properties_length</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>properties</code> (Multiple formats supported): Properties data in any of these formats:</p>
<ul>
<li><code>List&lt;Struct&lt;key, value&gt;&gt;</code> - Legacy format</li>
<li><code>Dictionary&lt;Int32, Binary&gt;</code> - JSONB format (optimized)</li>
<li><code>Dictionary&lt;Int32, List&lt;Struct&gt;&gt;</code> - Dictionary-encoded legacy</li>
<li><code>Binary</code> - Non-dictionary JSONB</li>
</ul>
</li>
</ul>
<p><strong>Returns:</strong> <code>Int32</code> - Number of properties</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">-- Works with regular properties</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">properties_length</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">prop_count</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="c1">-- Works with dictionary-encoded properties</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">properties_length</span><span class="p">(</span><span class="n">properties_to_dict</span><span class="p">(</span><span class="n">properties</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">prop_count</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="c1">-- JSONB property counting</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">properties_length</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">prop_count</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="properties_to_dictproperties"><code>properties_to_dict(properties)</code><a class="headerlink" href="#properties_to_dictproperties" title="Permanent link">&para;</a></h5>
<p>Converts a properties list to a dictionary-encoded array for memory efficiency.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">properties_to_dict</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>properties</code> (<code>List&lt;Struct&lt;key: Utf8, value: Utf8&gt;&gt;</code>): Properties list to encode</li>
</ul>
<p><strong>Returns:</strong> <code>Dictionary&lt;Int32, List&lt;Struct&lt;key: Utf8, value: Utf8&gt;&gt;&gt;</code> - Dictionary-encoded properties</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1">-- Convert properties to dictionary encoding for memory efficiency</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">properties_to_dict</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">dict_props</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="c1">-- Use with other functions via properties_to_array</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">array_length</span><span class="p">(</span><span class="n">properties_to_array</span><span class="p">(</span><span class="n">properties_to_dict</span><span class="p">(</span><span class="n">properties</span><span class="p">)))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">prop_count</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong>Note:</strong> Dictionary encoding can reduce memory usage by 50-80% for datasets with repeated property patterns.</p>
<h5 id="properties_to_jsonbproperties"><code>properties_to_jsonb(properties)</code><a class="headerlink" href="#properties_to_jsonbproperties" title="Permanent link">&para;</a></h5>
<p>Converts a properties list to binary JSONB format with dictionary encoding for efficient storage and querying.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>properties</code> (Multiple formats supported): Properties in any of these formats:</p>
<ul>
<li><code>List&lt;Struct&lt;key: Utf8, value: Utf8&gt;&gt;</code> - Regular properties list</li>
<li><code>Dictionary&lt;Int32, List&lt;Struct&gt;&gt;</code> - Dictionary-encoded properties</li>
<li><code>Binary</code> - Non-dictionary JSONB</li>
<li><code>Dictionary&lt;Int32, Binary&gt;</code> - JSONB format</li>
</ul>
</li>
</ul>
<p><strong>Returns:</strong> <code>Dictionary&lt;Int32, Binary&gt;</code> - Dictionary-encoded JSONB object containing the properties as key-value pairs</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">-- Convert properties to JSONB format</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">jsonb_props</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span><span class="p">;</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="c1">-- Use with other JSONB functions</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;hostname&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">hostname</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span><span class="p">;</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="c1">-- Convert dictionary-encoded properties to JSONB</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties_to_dict</span><span class="p">(</span><span class="n">properties</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">jsonb_props</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong>Note:</strong> This function returns <code>Dictionary&lt;Int32, Binary&gt;</code> format for optimal memory usage with Arrow's built-in dictionary encoding.</p>
<h5 id="properties_to_arraydict_properties"><code>properties_to_array(dict_properties)</code><a class="headerlink" href="#properties_to_arraydict_properties" title="Permanent link">&para;</a></h5>
<p>Converts dictionary-encoded properties back to a regular array for compatibility with standard functions.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">properties_to_array</span><span class="p">(</span><span class="n">dict_properties</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>dict_properties</code> (<code>Dictionary&lt;Int32, List&lt;Struct&gt;&gt;</code>): Dictionary-encoded properties</li>
</ul>
<p><strong>Returns:</strong> <code>List&lt;Struct&lt;key: Utf8, value: Utf8&gt;&gt;</code> - Regular properties array</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">-- Convert dictionary-encoded properties back to array</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">properties_to_array</span><span class="p">(</span><span class="n">properties_to_dict</span><span class="p">(</span><span class="n">properties</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">props</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="c1">-- Use with array functions</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">array_length</span><span class="p">(</span><span class="n">properties_to_array</span><span class="p">(</span><span class="n">properties_to_dict</span><span class="p">(</span><span class="n">properties</span><span class="p">)))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">count</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">measures</span><span class="p">;</span>
</span></code></pre></div></p>
<h4 id="histogram-functions">Histogram Functions<a class="headerlink" href="#histogram-functions" title="Permanent link">&para;</a></h4>
<p>Micromegas provides a comprehensive set of functions for creating and analyzing histograms, enabling efficient statistical analysis of large datasets.</p>
<h5 id="make_histogramstart-end-bins-values"><code>make_histogram(start, end, bins, values)</code><a class="headerlink" href="#make_histogramstart-end-bins-values" title="Permanent link">&para;</a></h5>
<p>Creates histogram data from numeric values with specified range and bin count.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">make_histogram</span><span class="p">(</span><span class="k">start</span><span class="p">,</span><span class="w"> </span><span class="k">end</span><span class="p">,</span><span class="w"> </span><span class="n">bins</span><span class="p">,</span><span class="w"> </span><span class="k">values</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>start</code> (<code>Float64</code>): Histogram minimum value</p>
</li>
<li>
<p><code>end</code> (<code>Float64</code>): Histogram maximum value</p>
</li>
<li>
<p><code>bins</code> (<code>Int64</code>): Number of histogram bins</p>
</li>
<li>
<p><code>values</code> (<code>Float64</code>): Column of numeric values to histogram</p>
</li>
</ul>
<p><strong>Returns:</strong> Histogram structure with buckets and counts</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">-- Create histogram of response times (0-50ms, 20 bins)</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">make_histogram</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="k">CAST</span><span class="p">(</span><span class="n">duration</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">FLOAT64</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">duration_histogram</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">view_instance</span><span class="p">(</span><span class="s1">&#39;thread_spans&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;web_server_123&#39;</span><span class="p">)</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;handle_request&#39;</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="sum_histogramshistogram_column"><code>sum_histograms(histogram_column)</code><a class="headerlink" href="#sum_histogramshistogram_column" title="Permanent link">&para;</a></h5>
<p>Aggregates multiple histograms by summing their bins.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">sum_histograms</span><span class="p">(</span><span class="n">histogram_column</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>histogram_column</code> (Histogram): Column containing histogram values</li>
</ul>
<p><strong>Returns:</strong> Combined histogram with summed bins</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">-- Combine histograms across processes</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">sum_histograms</span><span class="p">(</span><span class="n">duration_histogram</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">combined_histogram</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">cpu_usage_per_process_per_minute</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">time_bin</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 hour&#39;</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="quantile_from_histogramhistogram-quantile"><code>quantile_from_histogram(histogram, quantile)</code><a class="headerlink" href="#quantile_from_histogramhistogram-quantile" title="Permanent link">&para;</a></h5>
<p>Estimates a quantile value from a histogram.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="n">quantile_from_histogram</span><span class="p">(</span><span class="n">histogram</span><span class="p">,</span><span class="w"> </span><span class="n">quantile</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li>
<p><code>histogram</code> (Histogram): Histogram to analyze</p>
</li>
<li>
<p><code>quantile</code> (<code>Float64</code>): Quantile to estimate (0.0 to 1.0)</p>
</li>
</ul>
<p><strong>Returns:</strong> <code>Float64</code> - Estimated quantile value</p>
<p><strong>Examples:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1">-- Get median (50th percentile) response time</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">quantile_from_histogram</span><span class="p">(</span><span class="n">duration_histogram</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">median_duration</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">performance_histograms</span><span class="p">;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="c1">-- Get 95th percentile response time</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">quantile_from_histogram</span><span class="p">(</span><span class="n">duration_histogram</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">95</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">p95_duration</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">performance_histograms</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="variance_from_histogramhistogram"><code>variance_from_histogram(histogram)</code><a class="headerlink" href="#variance_from_histogramhistogram" title="Permanent link">&para;</a></h5>
<p>Calculates variance from histogram data.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">variance_from_histogram</span><span class="p">(</span><span class="n">histogram</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>histogram</code> (Histogram): Histogram to analyze</li>
</ul>
<p><strong>Returns:</strong> <code>Float64</code> - Variance of the histogram data</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1">-- Calculate response time variance</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">variance_from_histogram</span><span class="p">(</span><span class="n">duration_histogram</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">duration_variance</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">performance_histograms</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="count_from_histogramhistogram"><code>count_from_histogram(histogram)</code><a class="headerlink" href="#count_from_histogramhistogram" title="Permanent link">&para;</a></h5>
<p>Extracts the total count of values from a histogram.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">count_from_histogram</span><span class="p">(</span><span class="n">histogram</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>histogram</code> (Histogram): Histogram to analyze</li>
</ul>
<p><strong>Returns:</strong> <code>UInt64</code> - Total number of values in the histogram</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1">-- Get total sample count from histogram</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">count_from_histogram</span><span class="p">(</span><span class="n">duration_histogram</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_samples</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">performance_histograms</span><span class="p">;</span>
</span></code></pre></div></p>
<h5 id="sum_from_histogramhistogram"><code>sum_from_histogram(histogram)</code><a class="headerlink" href="#sum_from_histogramhistogram" title="Permanent link">&para;</a></h5>
<p>Extracts the sum of all values from a histogram.</p>
<p><strong>Syntax:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">sum_from_histogram</span><span class="p">(</span><span class="n">histogram</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><code>histogram</code> (Histogram): Histogram to analyze</li>
</ul>
<p><strong>Returns:</strong> <code>Float64</code> - Sum of all values in the histogram</p>
<p><strong>Example:</strong>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1">-- Get total duration from histogram</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">sum_from_histogram</span><span class="p">(</span><span class="n">duration_histogram</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_duration</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">performance_histograms</span><span class="p">;</span>
</span></code></pre></div></p>
<h2 id="standard-sql-functions">Standard SQL Functions<a class="headerlink" href="#standard-sql-functions" title="Permanent link">&para;</a></h2>
<p>Micromegas supports all standard DataFusion SQL functions including math, string, date/time, conditional, and array functions. For a complete list with examples, see the <a href="https://datafusion.apache.org/user-guide/sql/scalar_functions.html">DataFusion Scalar Functions documentation</a>.</p>
<h2 id="advanced-query-patterns">Advanced Query Patterns<a class="headerlink" href="#advanced-query-patterns" title="Permanent link">&para;</a></h2>
<h3 id="histogram-analysis">Histogram Analysis<a class="headerlink" href="#histogram-analysis" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1">-- Create performance histogram (0-100ms, 10 bins)</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="n">make_histogram</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">response_time_ms_histogram</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">view_instance</span><span class="p">(</span><span class="s1">&#39;thread_spans&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;web_server&#39;</span><span class="p">)</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;handle_request&#39;</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span><span class="w">  </span><span class="c1">-- &gt; 1ms</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1">-- Analyze histogram statistics</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">    </span><span class="n">quantile_from_histogram</span><span class="p">(</span><span class="n">response_time_histogram</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">median_ms</span><span class="p">,</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">    </span><span class="n">quantile_from_histogram</span><span class="p">(</span><span class="n">response_time_histogram</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">95</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">p95_ms</span><span class="p">,</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">    </span><span class="n">quantile_from_histogram</span><span class="p">(</span><span class="n">response_time_histogram</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">99</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">p99_ms</span><span class="p">,</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="n">variance_from_histogram</span><span class="p">(</span><span class="n">response_time_histogram</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">variance</span><span class="p">,</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">    </span><span class="n">count_from_histogram</span><span class="p">(</span><span class="n">response_time_histogram</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sample_count</span><span class="p">,</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">    </span><span class="n">sum_from_histogram</span><span class="p">(</span><span class="n">response_time_histogram</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_time_ms</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="k">FROM</span><span class="w"> </span><span class="n">performance_histograms</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">time_bin</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 hour&#39;</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1">-- Aggregate histograms across multiple processes</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="n">time_bin</span><span class="p">,</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">    </span><span class="n">sum_histograms</span><span class="p">(</span><span class="n">cpu_usage_histo</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">combined_cpu_histogram</span><span class="p">,</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="n">quantile_from_histogram</span><span class="p">(</span><span class="n">sum_histograms</span><span class="p">(</span><span class="n">cpu_usage_histo</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="mi">95</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">p95_cpu</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="k">FROM</span><span class="w"> </span><span class="n">cpu_usage_per_process_per_minute</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">time_bin</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">time_bin</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">time_bin</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="property-extraction-and-filtering">Property Extraction and Filtering<a class="headerlink" href="#property-extraction-and-filtering" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1">-- Find logs with specific thread names</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="k">SELECT</span><span class="w"> </span><span class="k">time</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">process_properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;thread-name&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">thread</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">process_properties</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;thread-name&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%worker%&#39;</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="high-performance-jsonb-property-access">High-Performance JSONB Property Access<a class="headerlink" href="#high-performance-jsonb-property-access" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1">-- Convert properties to JSONB for better performance</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="k">SELECT</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">    </span><span class="k">time</span><span class="p">,</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">    </span><span class="n">msg</span><span class="p">,</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">    </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">service</span><span class="p">,</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;version&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">version</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;env&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;production&#39;</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 hour&#39;</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1">-- Efficient property filtering with JSONB</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="k">WITH</span><span class="w"> </span><span class="n">jsonb_logs</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">    </span><span class="k">SELECT</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">        </span><span class="k">time</span><span class="p">,</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="w">        </span><span class="k">level</span><span class="p">,</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="w">        </span><span class="n">msg</span><span class="p">,</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="w">        </span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">jsonb_props</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 day&#39;</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="p">)</span>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="k">SELECT</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a><span class="w">    </span><span class="k">time</span><span class="p">,</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">    </span><span class="k">level</span><span class="p">,</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">    </span><span class="n">msg</span><span class="p">,</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="w">    </span><span class="n">property_get</span><span class="p">(</span><span class="n">jsonb_props</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">service</span><span class="p">,</span>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="w">    </span><span class="n">property_get</span><span class="p">(</span><span class="n">jsonb_props</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;request_id&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">request_id</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="k">FROM</span><span class="w"> </span><span class="n">jsonb_logs</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">jsonb_props</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;error_code&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1">-- Property aggregation with optimal performance</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="k">SELECT</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">    </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">service</span><span class="p">,</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;env&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">environment</span><span class="p">,</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">event_count</span><span class="p">,</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span><span class="w"> </span><span class="k">WHEN</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">END</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">error_count</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;1 hour&#39;</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">property_get</span><span class="p">(</span><span class="n">properties_to_jsonb</span><span class="p">(</span><span class="n">properties</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">service</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">error_count</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="json-data-processing">JSON Data Processing<a class="headerlink" href="#json-data-processing" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1">-- Parse and extract configuration from JSON logs</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">    </span><span class="k">time</span><span class="p">,</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="n">msg</span><span class="p">,</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="w">    </span><span class="n">jsonb_as_string</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">service_name</span><span class="p">,</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="n">jsonb_as_i64</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;port&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">port</span><span class="p">,</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="w">    </span><span class="n">jsonb_as_f64</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;cpu_limit&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cpu_limit</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%{%&#39;</span><span class="w">  </span><span class="c1">-- Contains JSON</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1">-- Aggregate metrics from JSON payloads</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="w">    </span><span class="n">jsonb_as_string</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;service&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">service</span><span class="p">,</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">event_count</span><span class="p">,</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">jsonb_as_f64</span><span class="p">(</span><span class="n">jsonb_get</span><span class="p">(</span><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span><span class="w"> </span><span class="s1">&#39;response_time&#39;</span><span class="p">)))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_response_ms</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;%response_time%&#39;</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">jsonb_parse</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">service</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">avg_response_ms</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="time-based-aggregation">Time-based Aggregation<a class="headerlink" href="#time-based-aggregation" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1">-- Hourly error counts</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="n">date_trunc</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">time</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">hour</span><span class="p">,</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">error_count</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="k">FROM</span><span class="w"> </span><span class="n">log_entries</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="k">WHERE</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="c1">-- Fatal and Error</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;24 hours&#39;</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">date_trunc</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">time</span><span class="p">)</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">hour</span><span class="p">;</span>
</span></code></pre></div>
<h3 id="performance-trace-analysis">Performance Trace Analysis<a class="headerlink" href="#performance-trace-analysis" title="Permanent link">&para;</a></h3>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="c1">-- Top 10 slowest functions with statistics</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="k">SELECT</span><span class="w"> </span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">    </span><span class="n">name</span><span class="p">,</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">call_count</span><span class="p">,</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_ms</span><span class="p">,</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">    </span><span class="k">MAX</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">max_ms</span><span class="p">,</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w">    </span><span class="n">STDDEV</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1000000</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">stddev_ms</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="k">FROM</span><span class="w"> </span><span class="n">view_instance</span><span class="p">(</span><span class="s1">&#39;thread_spans&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;my_process&#39;</span><span class="p">)</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="k">WHERE</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">100000</span><span class="w">  </span><span class="c1">-- &gt; 0.1ms</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">name</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">avg_ms</span><span class="w"> </span><span class="k">DESC</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="k">LIMIT</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span></code></pre></div>
<h2 id="datafusion-reference">DataFusion Reference<a class="headerlink" href="#datafusion-reference" title="Permanent link">&para;</a></h2>
<p>Micromegas supports all standard DataFusion SQL syntax, functions, and operators. For complete documentation including functions, operators, data types, and SQL syntax, see the <a href="https://datafusion.apache.org/user-guide/sql/">Apache DataFusion SQL Reference</a>.</p>
<h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><strong><a href="../query-patterns/">Query Patterns</a></strong> - Common observability query patterns</li>
<li><strong><a href="../performance/">Performance Guide</a></strong> - Optimize your queries for best performance</li>
<li><strong><a href="../schema-reference/">Schema Reference</a></strong> - Complete view and field reference</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "search.highlight", "search.suggest", "toc.follow", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>